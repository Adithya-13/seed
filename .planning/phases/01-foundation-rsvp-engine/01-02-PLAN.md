---
phase: 01-foundation-rsvp-engine
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - seed/Presentation/Views/RSVPDisplayView.swift
  - seed/Presentation/Views/PlaybackControlsView.swift
  - seed/Presentation/ViewModels/RSVPViewModel.swift
  - seed/ContentView.swift
autonomous: false

must_haves:
  truths:
    - "User sees current word displayed with smart anchoring (bold letters)"
    - "User can play/pause playback with button"
    - "User can adjust WPM in real-time with slider"
    - "User sees progress indicator showing current word / total words"
    - "Playback is visually smooth at 300 WPM"
  artifacts:
    - path: "seed/Presentation/Views/RSVPDisplayView.swift"
      provides: "Word display with smart anchoring visualization"
      exports: ["RSVPDisplayView"]
    - path: "seed/Presentation/Views/PlaybackControlsView.swift"
      provides: "Playback controls (play/pause, speed, progress)"
      exports: ["PlaybackControlsView"]
    - path: "seed/Presentation/ViewModels/RSVPViewModel.swift"
      provides: "ViewModel connecting UI to domain"
      exports: ["RSVPViewModel"]
  key_links:
    - from: "RSVPDisplayView"
      to: "PlaybackState.currentWord"
      via: "SwiftUI binding for reactive display"
      pattern: "@ObservedObject.*playbackState"
    - from: "PlaybackControlsView"
      to: "PlaybackState methods"
      via: "Button actions call play/pause/seek"
      pattern: "Button.*action.*play\\(\\)"
    - from: "RSVPViewModel"
      to: "RSVPEngine"
      via: "ViewModel owns engine instance"
      pattern: "RSVPEngine\\(.*\\)"
---

<objective>
Build SwiftUI presentation layer with RSVP display and playback controls.

Purpose: User-facing interface for word display with anchoring and playback control.
Output: Views and ViewModel connecting UI to domain engine.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation-rsvp-engine/01-01-SUMMARY.md

**Depends on Plan 01:**
- RSVPEngine (timing, CADisplayLink)
- PlaybackState (observable model)
- SmartAnchor (anchor range calculation)
- WordTokenizer (text processing)

**UI Requirements:**
- RSVP-01: Fixed position word display
- RSVP-02: ORP focal point (center alignment)
- RSVP-03: Visual smart anchoring (bold first letters)
- RSVP-04: Real-time WPM slider
- RSVP-05: Play/pause buttons
- RSVP-06: Seek control (word position slider or tap)
- RSVP-07: Progress display (X / Y words)

**Design constraints:**
- Apple HIG compliance (native iOS patterns)
- Eye-friendly colors (avoid harsh contrasts)
- Minimal UI (focus on word display)
- Dynamic Type support (accessibility)
</context>

<tasks>

<task type="auto">
  <name>Create RSVPViewModel</name>
  <files>seed/Presentation/ViewModels/RSVPViewModel.swift</files>
  <action>
Create ObservableObject class RSVPViewModel with:
- engine: RSVPEngine (owns engine instance)
- playbackState: PlaybackState (passed to engine, published for views)

Methods:
- loadText(_ text: String): tokenizes via WordTokenizer, sets playbackState.words
- play(), pause(), seek(to: Int), adjustSpeed(wpm: Int): delegate to engine/state

Initialize engine in init(), wire playbackState reactivity.
  </action>
  <verify>Build succeeds, ViewModel compiles</verify>
  <done>ViewModel bridges UI and domain layer</done>
</task>

<task type="auto">
  <name>Create RSVPDisplayView</name>
  <files>seed/Presentation/Views/RSVPDisplayView.swift</files>
  <action>
Create SwiftUI view RSVPDisplayView accepting @ObservedObject playbackState: PlaybackState.

Display current word centered with:
- Large font (system, size 32, weight .medium)
- Smart anchoring via AttributedString (bold letters from SmartAnchor.anchorRange)
- Fixed frame (prevents layout shift between words)
- Eye-friendly foreground color (.primary with reduced opacity for comfort)

Example: "reading" displays as "**re**ading" (first 2 letters bold).

Use .font(.system(size: 32, weight: .medium, design: .default)) with Dynamic Type support.
  </action>
  <verify>Build succeeds, preview shows word with anchoring</verify>
  <done>Word displays centered with smart anchoring visible</done>
</task>

<task type="auto">
  <name>Create PlaybackControlsView</name>
  <files>seed/Presentation/Views/PlaybackControlsView.swift</files>
  <action>
Create SwiftUI view PlaybackControlsView accepting @ObservedObject playbackState: PlaybackState and callbacks for actions.

Components:
1. Play/Pause button (SF Symbol: play.fill / pause.fill) - toggles isPlaying
2. WPM slider (range 100-600, step 50, default 300) - adjusts playbackState.wpm
3. Progress label: "\(currentIndex + 1) / \(words.count)" - shows position
4. Progress bar (ProgressView with value/total) - visual progress
5. Seek slider (optional, range 0...words.count-1) - jumps to word position

Layout: VStack with controls, Apple HIG spacing (16pt). Use native controls (Button, Slider).
  </action>
  <verify>Build succeeds, preview shows all controls</verify>
  <done>Controls render and bind to playbackState properties</done>
</task>

<task type="auto">
  <name>Wire views in ContentView</name>
  <files>seed/ContentView.swift</files>
  <action>
Replace placeholder "Hello, world!" with:
- @StateObject viewModel = RSVPViewModel()
- VStack containing:
  - RSVPDisplayView(playbackState: viewModel.playbackState)
  - PlaybackControlsView(playbackState: viewModel.playbackState, onPlay: viewModel.play, onPause: viewModel.pause, ...)
- Sample text loaded in .onAppear: viewModel.loadText("Sample RSVP text for testing smooth playback.")

Use standard padding, Apple HIG layout.
  </action>
  <verify>App builds and launches in simulator</verify>
  <done>ContentView integrates RSVPDisplayView and PlaybackControlsView</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>RSVP display with smart anchoring and playback controls</what-built>
  <how-to-verify>
1. Build and run in Xcode simulator (âŒ˜R)
2. Launch app - should see sample text ready to play
3. Tap Play button - word display starts, advances word-by-word
4. Check smooth playback at 300 WPM (no stuttering, consistent timing)
5. Verify smart anchoring visible (first 1-3 letters bold based on word length)
6. Adjust WPM slider (200-400 range) - playback speed changes in real-time
7. Tap Pause - playback stops, word stays visible
8. Check progress indicator updates (X / Y words increases)
9. Verify no layout shift (word position fixed, controls stable)
10. Test on iPhone 15 Pro simulator for realistic timing
  </how-to-verify>
  <resume-signal>Type "approved" if playback smooth and anchoring visible, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] App builds without errors
- [ ] RSVPDisplayView renders word with anchoring
- [ ] PlaybackControlsView shows all controls
- [ ] ContentView integrates both views
- [ ] Human verification passed (playback smooth, anchoring works)
</verification>

<success_criteria>
- All tasks completed
- UI layer complete and wired to domain
- Visual checkpoint passed (smooth playback confirmed)
- No build errors
- Ready for text input integration (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-rsvp-engine/01-02-SUMMARY.md`
</output>
