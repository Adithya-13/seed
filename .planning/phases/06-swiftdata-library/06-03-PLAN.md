---
phase: 06-swiftdata-library
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [seed/ContentView.swift, seed/Screens/LibraryView.swift]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Search tab auto-focuses search field when selected"
  artifacts:
    - path: "seed/ContentView.swift"
      provides: "Pass @FocusState binding to Search tab LibraryView"
      exports: ["ContentView"]
    - path: "seed/Screens/LibraryView.swift"
      provides: "Accept optional @FocusState binding, auto-focus on appear if provided"
      exports: ["LibraryView"]
  key_links:
    - from: "ContentView Search tab (tag 2)"
      to: "LibraryView"
      via: "@FocusState binding parameter"
      pattern: "LibraryView\\(.*focusSearch.*\\)"
---

<objective>
Differentiate Search tab from Library tab by auto-focusing search field on appear.

Purpose: Close verification gap - Search tab should have distinct behavior vs Library tab
Output: Search tab focuses search field automatically, Library tab doesn't
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-swiftdata-library/06-VERIFICATION.md

**Gap being closed:**
VERIFICATION.md identified: "Search tab shows LibraryView with .searchable, but search functionality not distinct from Library tab"

**Existing implementation:**
- ContentView.swift line 36: Search tab renders LibraryView (tag 2)
- ContentView.swift line 28: Library tab renders LibraryView (tag 1)
- LibraryView.swift line 83: .searchable(text: $searchText)
- Both tabs render identical LibraryView, no differentiation

**Solution approach:**
Add optional @FocusState binding parameter to LibraryView. ContentView passes binding only to Search tab. LibraryView auto-focuses search if binding provided.
</context>

<tasks>

<task type="auto">
  <name>Add @FocusState to ContentView for search field</name>
  <files>seed/ContentView.swift</files>
  <action>
    1. Add @FocusState after line 13: `@FocusState private var isSearchFieldFocused: Bool`
    2. Update Search tab LibraryView (line 36) to pass binding: `LibraryView(focusSearch: _isSearchFieldFocused)`
    3. Keep Library tab LibraryView (line 28) without parameter: `LibraryView()`
  </action>
  <verify>ContentView.swift compiles, @FocusState declared, Search tab passes binding</verify>
  <done>ContentView passes @FocusState binding to Search tab LibraryView only</done>
</task>

<task type="auto">
  <name>Update LibraryView to accept optional focus binding</name>
  <files>seed/Screens/LibraryView.swift</files>
  <action>
    1. Add optional @FocusState parameter after line 14: `var focusSearch: FocusState<Bool>.Binding? = nil`
    2. Add .onAppear modifier to Group (line 27) BEFORE .searchable:
       ```swift
       .onAppear {
           if let binding = focusSearch {
               binding.wrappedValue = true
           }
       }
       ```
    3. Update .searchable (line 83) to bind focus: `.searchable(text: $searchText, prompt: "Search library...")`
       â†’ Then add after searchable: `.focused(focusSearch ?? FocusState<Bool>().projectedValue, equals: true)`

    Wait, SwiftUI @FocusState requires non-optional. Simplify:

    **Revised approach:**
    1. Add optional parameter after line 14: `var autoFocusSearch: Bool = false`
    2. Add @FocusState private var after line 14: `@FocusState private var isSearchFocused: Bool`
    3. Update .searchable (line 83) to: `.searchable(text: $searchText, prompt: "Search library...").focused($isSearchFocused)`
    4. Add .onAppear to Group (line 27): `.onAppear { if autoFocusSearch { isSearchFocused = true } }`
  </action>
  <verify>xcodebuild compiles, LibraryView accepts autoFocusSearch parameter</verify>
  <done>LibraryView auto-focuses search field when autoFocusSearch = true</done>
</task>

<task type="auto">
  <name>Update ContentView to pass autoFocusSearch flag</name>
  <files>seed/ContentView.swift</files>
  <action>
    1. Remove @FocusState from task 1 (simpler approach - use Bool parameter)
    2. Update Search tab LibraryView (line 36) to: `LibraryView(autoFocusSearch: true)`
    3. Keep Library tab LibraryView (line 28) as: `LibraryView()`
  </action>
  <verify>xcodebuild succeeds, ContentView passes autoFocusSearch to Search tab</verify>
  <done>Search tab passes autoFocusSearch: true, Library tab doesn't</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild -scheme seed build succeeds
- [ ] LibraryView has autoFocusSearch: Bool parameter
- [ ] ContentView Search tab passes autoFocusSearch: true
- [ ] ContentView Library tab doesn't pass parameter (default false)
- [ ] LibraryView uses @FocusState and .focused() modifier
</verification>

<success_criteria>

- All tasks completed
- xcodebuild succeeds with no errors
- Search tab LibraryView receives autoFocusSearch: true
- Library tab LibraryView uses default autoFocusSearch: false
- Gap closed: Search tab now has distinct behavior (auto-focuses search field)
</success_criteria>

<output>
After completion, create `.planning/phases/06-swiftdata-library/06-03-SUMMARY.md`
</output>
