---
phase: 06-swiftdata-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [seed/Domain/Models/SavedText.swift, seed/Screens/LibraryView.swift, seed/Screens/EmptyLibraryView.swift]
autonomous: true

must_haves:
  truths:
    - "User can save text and see it appear in library list"
    - "Library shows title, word count, source badge per item"
    - "User can delete text via swipe gesture"
    - "Empty library shows 3 input mode buttons"
  artifacts:
    - path: "seed/Domain/Models/SavedText.swift"
      provides: "SwiftData model for saved texts"
      contains: "@Model"
      exports: ["SavedText"]
    - path: "seed/Screens/LibraryView.swift"
      provides: "Library list rendering with search"
      min_lines: 40
    - path: "seed/Screens/EmptyLibraryView.swift"
      provides: "Empty state with input mode buttons"
      min_lines: 20
  key_links:
    - from: "LibraryView"
      to: "SavedText"
      via: "@Query from SwiftData"
      pattern: "@Query.*SavedText"
    - from: "LibraryView"
      to: "swipe delete"
      via: ".onDelete modifier"
      pattern: "onDelete|swipeActions"
---

<objective>
Create SwiftData persistence + library UI with search/filter and empty state.

Purpose: Replace v1 @AppStorage session tracking with SwiftData library-first flow.
Output: SavedText model, LibraryView with list/search/delete, EmptyLibraryView with input buttons.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Phase 5 completed code reorganization - Screens/ and Components/ now established.

Existing models reference:
@seed/Domain/Models/ReadingSession.swift

Existing screens reference:
@seed/Screens/TextInputView.swift
@seed/ContentView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SavedText SwiftData model</name>
  <files>seed/Domain/Models/SavedText.swift</files>
  <action>
Create SwiftData model with @Model macro:
- id: UUID
- content: String (full text)
- title: String (user-provided or first 50 chars)
- wordCount: Int
- sourceType: enum (text, pdf, link)
- createdAt: Date
- lastReadAt: Date?

Add convenience init and computed properties if needed (preview text, etc).
Use SwiftData best practices - @Model, @Attribute, conform to Codable if needed.
  </action>
  <verify>xcodebuild -project seed.xcodeproj -scheme seed build | grep "BUILD SUCCEEDED"</verify>
  <done>SavedText model compiles, SwiftData ready</done>
</task>

<task type="auto">
  <name>Task 2: Create LibraryView with list/search/delete</name>
  <files>seed/Screens/LibraryView.swift</files>
  <action>
Create LibraryView:
- @Query(sort: \SavedText.createdAt, order: .reverse) var texts: [SavedText]
- @State var searchText = ""
- Filtered list based on searchText (title/content contains)
- List with ForEach over filtered texts
- Row shows: title (bold), "\(wordCount) words", source badge (SF Symbol based on sourceType: doc.text/link/doc.richtext)
- .swipeActions with delete button â†’ modelContext.delete(text)
- .searchable(text: $searchText, prompt: "Search library...")
- Navigation to reading session on tap (defer wiring to 06-02)

If list empty after filter, show "No results" text.
If texts.isEmpty, show EmptyLibraryView (conditional).
  </action>
  <verify>xcodebuild builds, LibraryView preview renders</verify>
  <done>Library list renders, search works, swipe delete works</done>
</task>

<task type="auto">
  <name>Task 3: Create EmptyLibraryView with input mode buttons</name>
  <files>seed/Screens/EmptyLibraryView.swift</files>
  <action>
Create EmptyLibraryView:
- VStack centered with icon (book.closed), title "No texts yet", subtitle "Start reading by choosing an input method"
- 3 large buttons stacked vertically:
  - "Paste Text" (doc.text icon)
  - "From Link" (link icon)
  - "Upload PDF" (doc.richtext icon)
- Buttons trigger placeholder actions (print for now, will wire in 06-02)
- Use system colors, SF Symbols, padding/spacing per iOS design

Match existing UI patterns from TextInputView if applicable.
  </action>
  <verify>xcodebuild builds, EmptyLibraryView preview renders</verify>
  <done>Empty state displays with 3 input mode buttons</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild -project seed.xcodeproj -scheme seed build succeeds
- [ ] SavedText model has @Model macro
- [ ] LibraryView uses @Query for SavedText
- [ ] Search filters library items
- [ ] Swipe delete removes items from modelContext
- [ ] EmptyLibraryView shows when no texts
</verification>

<success_criteria>
- All tasks completed
- SwiftData model compiles
- Library UI renders
- Search and delete functional
- Empty state with buttons displays
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-swiftdata-library/06-01-SUMMARY.md`
</output>
