---
phase: 04-stats-comprehension
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - seed/Domain/Models/ReadingSession.swift
  - seed/Data/SessionStore.swift
  - seed/Presentation/Views/CompletionStatsView.swift
  - seed/Presentation/ViewModels/RSVPViewModel.swift
  - seed/ContentView.swift
autonomous: true

must_haves:
  truths:
    - "User sees completion stats after finishing reading session"
    - "Stats show time taken, WPM, and word count"
    - "Stats persist across app launches"
  artifacts:
    - path: "seed/Domain/Models/ReadingSession.swift"
      provides: "Session data model"
      min_lines: 15
    - path: "seed/Data/SessionStore.swift"
      provides: "Session persistence"
      exports: ["SessionStore"]
    - path: "seed/Presentation/Views/CompletionStatsView.swift"
      provides: "Stats display UI"
      min_lines: 40
  key_links:
    - from: "RSVPViewModel"
      to: "SessionStore"
      via: "save session on completion"
      pattern: "sessionStore.*save|addSession"
    - from: "CompletionStatsView"
      to: "ReadingSession"
      via: "display session data"
      pattern: "session\\.(duration|wpm|wordCount)"
---

<objective>
Session tracking with completion stats display.

Purpose: Track reading sessions and show performance stats (time, WPM, word count) after completion.
Output: ReadingSession model, SessionStore persistence, CompletionStatsView UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@seed/Domain/Models/PlaybackState.swift
@seed/Presentation/ViewModels/RSVPViewModel.swift
@seed/Domain/Models/AppSettings.swift
</context>

<tasks>

<task type="auto">
  <name>Create ReadingSession model</name>
  <files>seed/Domain/Models/ReadingSession.swift</files>
  <action>
Create Codable struct with:
- id: UUID
- startTime: Date
- endTime: Date
- wordCount: Int
- wpm: Int
- textSource: String (first 50 chars of text)

Computed properties:
- duration: TimeInterval (endTime - startTime)
- formattedDuration: String (minutes:seconds)

Follow @Observable pattern from PlaybackState.
  </action>
  <verify>Build succeeds, no TypeScript errors</verify>
  <done>ReadingSession model exists with all fields</done>
</task>

<task type="auto">
  <name>Create SessionStore for persistence</name>
  <files>seed/Data/SessionStore.swift</files>
  <action>
Create @Observable class SessionStore:
- @ObservationIgnored @AppStorage("sessions") stored as JSON array
- sessions: [ReadingSession] array
- addSession(_ session: ReadingSession) method
- recentSessions(limit: Int) -> [ReadingSession]

Store sessions as JSON string in @AppStorage, decode on init.
Max 50 sessions (drop oldest if exceeded).
  </action>
  <verify>SessionStore can save/load sessions from UserDefaults</verify>
  <done>SessionStore persists sessions across launches</done>
</task>

<task type="auto">
  <name>Track session in RSVPViewModel</name>
  <files>seed/Presentation/ViewModels/RSVPViewModel.swift</files>
  <action>
Add SessionStore property to RSVPViewModel.
Track session start time when play() called (if first play).
When playback completes (currentIndex == words.count - 1):
- Calculate session data (duration, WPM, word count)
- Create ReadingSession
- Call sessionStore.addSession()

Add sessionCompleted: Bool published property to trigger stats view.
  </action>
  <verify>Session saved when playback completes</verify>
  <done>RSVPViewModel tracks and saves sessions</done>
</task>

<task type="auto">
  <name>Create CompletionStatsView</name>
  <files>seed/Presentation/Views/CompletionStatsView.swift</files>
  <action>
Create SwiftUI view accepting ReadingSession:
- Display time taken (formatted MM:SS)
- Display WPM (large, prominent)
- Display word count
- Display text source preview
- "Start New Session" button (dismisses view)

Use SF Symbols: clock.fill, speedometer, doc.text.fill
Follow eye-friendly color palette from 03-03 (warm tints).
  </action>
  <verify>npm run build succeeds</verify>
  <done>Stats view displays session data</done>
</task>

<task type="auto">
  <name>Wire CompletionStatsView to ContentView</name>
  <files>seed/ContentView.swift</files>
  <action>
Add .sheet modifier watching viewModel.sessionCompleted:
- Present CompletionStatsView with last session
- Reset sessionCompleted on dismiss

Sheet presentation pattern from onboarding (03-02).
  </action>
  <verify>Stats sheet appears after session completes</verify>
  <done>User sees stats after reading</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Build succeeds (xcodebuild)
- [ ] Session saves to UserDefaults
- [ ] Stats view shows after playback completion
- [ ] Stats display correct values (time, WPM, word count)
</verification>

<success_criteria>
- All tasks completed
- ReadingSession model created
- SessionStore persists data
- Stats view appears after completion
- No errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/04-stats-comprehension/04-01-SUMMARY.md`
</output>
