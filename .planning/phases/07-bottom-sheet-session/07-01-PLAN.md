---
phase: 07-bottom-sheet-session
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [seed/Screens/HomeView.swift, seed/Screens/SessionSetupSheet.swift]
autonomous: true

must_haves:
  truths:
    - "User taps input mode button → bottom sheet opens"
    - "Bottom sheet shows header with input mode name"
    - "User can paste text in text mode"
    - "User can enter URL in link mode"
    - "User can upload PDF in PDF mode"
    - "WPM selector shows 5 preset buttons"
    - "User can adjust WPM with +/- controls"
  artifacts:
    - path: "seed/Screens/SessionSetupSheet.swift"
      provides: "Bottom sheet modal with input modes and WPM selector"
      exports: ["SessionSetupSheet"]
      min_lines: 150
    - path: "seed/Screens/HomeView.swift"
      provides: "Sheet presentation from input buttons"
      contains: ".sheet(isPresented:"
  key_links:
    - from: "HomeView input buttons"
      to: "SessionSetupSheet"
      via: "@State sheet binding"
      pattern: "\\.sheet\\(isPresented.*SessionSetupSheet"
---

<objective>
Build bottom sheet modal for session setup with 3 input modes and WPM selector.

Purpose: New session UX per v2.0 requirements (bottom sheet replaces direct navigation)
Output: SessionSetupSheet component with text/link/PDF inputs + WPM controls
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Current HomeView state:**
- Lines 62-111: Three input buttons (Paste Text, From Link, Upload PDF) with placeholder actions
- Button design: HStack with icon + text, blue accent styling
- Placement: Empty state only (when no texts saved)

**Requirements coverage:**
- SESS-01: Tap button → sheet opens
- SESS-02: Sheet header per mode
- SESS-03: Text paste TextEditor
- SESS-04: URL TextField
- SESS-05: PDF DocumentPicker
- SESS-06: 5 WPM preset buttons (150/250/350/450/550)
- SESS-07: +/- WPM controls (±25 increments)

**Pattern:**
SwiftUI .sheet(isPresented:) modifier with @State bool binding
</context>

<tasks>

<task type="auto">
  <name>Create SessionSetupSheet component with 3 input modes</name>
  <files>seed/Screens/SessionSetupSheet.swift</files>
  <action>
    Create SessionSetupSheet.swift in seed/Screens/:

    ```swift
    import SwiftUI
    import UniformTypeIdentifiers

    struct SessionSetupSheet: View {
        enum InputMode {
            case text, link, pdf
        }

        let inputMode: InputMode
        @Binding var isPresented: Bool

        @State private var textInput = ""
        @State private var urlInput = ""
        @State private var showDocumentPicker = false
        @State private var selectedPDFURL: URL?

        var body: some View {
            NavigationStack {
                VStack(spacing: 24) {
                    // Input section per mode
                    switch inputMode {
                    case .text:
                        textInputView
                    case .link:
                        linkInputView
                    case .pdf:
                        pdfInputView
                    }

                    Spacer()

                    // WPM selector (placeholder for now)
                    Text("WPM Selector - Plan 02")
                        .foregroundColor(.secondary)
                }
                .padding()
                .navigationTitle("Start Session from \(modeTitle)")
                .navigationBarTitleDisplayMode(.inline)
                .toolbar {
                    ToolbarItem(placement: .cancellationAction) {
                        Button("Cancel") { isPresented = false }
                    }
                }
            }
        }

        private var modeTitle: String {
            switch inputMode {
            case .text: return "Text"
            case .link: return "Link"
            case .pdf: return "PDF"
            }
        }

        private var textInputView: some View {
            VStack(alignment: .leading, spacing: 8) {
                Text("Paste your text")
                    .font(.headline)
                TextEditor(text: $textInput)
                    .frame(height: 300)
                    .padding(8)
                    .background(Color(uiColor: .systemGray6))
                    .cornerRadius(8)
            }
        }

        private var linkInputView: some View {
            VStack(alignment: .leading, spacing: 8) {
                Text("Enter URL")
                    .font(.headline)
                TextField("https://example.com/article", text: $urlInput)
                    .textFieldStyle(.roundedBorder)
                    .keyboardType(.URL)
                    .autocapitalization(.none)
                Text("We'll extract the article text for you")
                    .font(.caption)
                    .foregroundColor(.secondary)
            }
        }

        private var pdfInputView: some View {
            VStack(alignment: .leading, spacing: 16) {
                Text("Upload PDF")
                    .font(.headline)

                Button {
                    showDocumentPicker = true
                } label: {
                    HStack {
                        Image(systemName: "doc.richtext")
                        Text(selectedPDFURL?.lastPathComponent ?? "Choose PDF File")
                        Spacer()
                        Image(systemName: "chevron.right")
                    }
                    .padding()
                    .background(Color(uiColor: .systemGray6))
                    .cornerRadius(8)
                }
                .buttonStyle(.plain)

                if selectedPDFURL != nil {
                    Text("PDF selected - extraction in next phase")
                        .font(.caption)
                        .foregroundColor(.secondary)
                }
            }
            .sheet(isPresented: $showDocumentPicker) {
                DocumentPicker(selectedURL: $selectedPDFURL)
            }
        }
    }

    struct DocumentPicker: UIViewControllerRepresentable {
        @Binding var selectedURL: URL?

        func makeUIViewController(context: Context) -> UIDocumentPickerViewController {
            let picker = UIDocumentPickerViewController(forOpeningContentTypes: [UTType.pdf])
            picker.delegate = context.coordinator
            return picker
        }

        func updateUIViewController(_ uiViewController: UIDocumentPickerViewController, context: Context) {}

        func makeCoordinator() -> Coordinator {
            Coordinator(self)
        }

        class Coordinator: NSObject, UIDocumentPickerDelegate {
            let parent: DocumentPicker

            init(_ parent: DocumentPicker) {
                self.parent = parent
            }

            func documentPicker(_ controller: UIDocumentPickerViewController, didPickDocumentsAt urls: [URL]) {
                parent.selectedURL = urls.first
            }
        }
    }
    ```

    Per SESS-02: Navigation title shows "Start Session from [Text/Link/PDF]"
    Per SESS-03: TextEditor for text paste
    Per SESS-04: TextField for URL with .URL keyboard
    Per SESS-05: DocumentPicker for PDF selection

    WPM selector placeholder - will implement in task 2
  </action>
  <verify>xcodebuild compiles, SessionSetupSheet.swift exists</verify>
  <done>SessionSetupSheet component created with 3 input modes</done>
</task>

<task type="auto">
  <name>Add WPM selector with presets and +/- controls</name>
  <files>seed/Screens/SessionSetupSheet.swift</files>
  <action>
    1. Add @State var wpm: Int = 250 after line ~15
    2. Replace "WPM Selector - Plan 02" placeholder with full WPM selector view:

    ```swift
    private var wpmSelectorView: some View {
        VStack(spacing: 16) {
            Text("Reading Speed")
                .font(.headline)

            // Preset buttons
            ScrollView(.horizontal, showsIndicators: false) {
                HStack(spacing: 12) {
                    ForEach([150, 250, 350, 450, 550], id: \.self) { speed in
                        Button {
                            wpm = speed
                        } label: {
                            Text("\(speed)")
                                .font(.headline)
                                .padding(.horizontal, 20)
                                .padding(.vertical, 12)
                                .background(wpm == speed ? Color.accentColor : Color(uiColor: .systemGray5))
                                .foregroundColor(wpm == speed ? .white : .primary)
                                .cornerRadius(8)
                        }
                    }
                }
                .padding(.horizontal, 4)
            }

            // Current WPM display with +/- controls
            HStack(spacing: 24) {
                Button {
                    wpm = max(50, wpm - 25)
                } label: {
                    Image(systemName: "minus.circle.fill")
                        .font(.title)
                        .foregroundColor(.accentColor)
                }

                VStack(spacing: 4) {
                    Text("\(wpm)")
                        .font(.system(size: 48, weight: .bold))
                    Text("words per minute")
                        .font(.caption)
                        .foregroundColor(.secondary)
                }

                Button {
                    wpm = min(1000, wpm + 25)
                } label: {
                    Image(systemName: "plus.circle.fill")
                        .font(.title)
                        .foregroundColor(.accentColor)
                }
            }
        }
        .padding(.vertical)
    }
    ```

    3. Use wpmSelectorView in body instead of placeholder

    Per SESS-06: 5 preset buttons (150/250/350/450/550)
    Per SESS-07: +/- controls with ±25 increments, min 50, max 1000
  </action>
  <verify>xcodebuild succeeds, WPM selector visible with presets + controls</verify>
  <done>WPM selector with 5 presets and +/- controls implemented</done>
</task>

<task type="auto">
  <name>Wire HomeView buttons to open SessionSetupSheet</name>
  <files>seed/Screens/HomeView.swift</files>
  <action>
    1. Add after line 14 (@State var searchText):
       ```swift
       @State private var showSessionSheet = false
       @State private var selectedInputMode: SessionSetupSheet.InputMode?
       ```

    2. Update "Paste Text" button action (line 62):
       ```swift
       Button {
           selectedInputMode = .text
           showSessionSheet = true
       } label: {
       ```

    3. Update "From Link" button action (line 79):
       ```swift
       Button {
           selectedInputMode = .link
           showSessionSheet = true
       } label: {
       ```

    4. Update "Upload PDF" button action (line 96):
       ```swift
       Button {
           selectedInputMode = .pdf
           showSessionSheet = true
       } label: {
       ```

    5. Add sheet modifier after .navigationTitle (line 171):
       ```swift
       .sheet(isPresented: $showSessionSheet) {
           if let mode = selectedInputMode {
               SessionSetupSheet(inputMode: mode, isPresented: $showSessionSheet)
           }
       }
       ```

    Per SESS-01: Tap button → sheet opens with correct mode
  </action>
  <verify>xcodebuild succeeds, tapping buttons opens sheet</verify>
  <done>HomeView buttons wired to SessionSetupSheet with correct input modes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild -scheme seed build succeeds
- [ ] SessionSetupSheet.swift exists with 3 input modes
- [ ] WPM selector shows 5 presets + +/- controls
- [ ] HomeView buttons open sheet with correct mode
- [ ] Sheet navigation title shows "Start Session from [mode]"
</verification>

<success_criteria>

- All tasks completed
- xcodebuild succeeds with no errors
- SessionSetupSheet component with text/link/PDF inputs
- WPM selector with 150/250/350/450/550 presets
- +/- WPM controls with ±25 increments
- HomeView buttons open sheet per input mode
- Requirements SESS-01 through SESS-07 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/07-bottom-sheet-session/07-01-SUMMARY.md`
</output>
